jQuery.extend({crossDomain:function(b){var c=$.Deferred();if(!XMLHttpRequest&&!XDomainRequest)throw"Unsupported Browser.";var a=new XMLHttpRequest;if(void 0==a.withCredentials)throw"Browser doesn't support CORS.";a.open(b.type,b.url,!0);a.onreadystatechange=function(){if(4==a.readyState&&200==a.status){var b=null;if(null!=a.responseXML)b=a.responseXML;else if(null!=a.responseText)try{b=JSON.parse(a.responseText)}catch(e){b=a.responseText}c.resolve(b)}};a.send();return c}});var JSON;JSON||(JSON={});
(function(){function b(a){return 10>a?"0"+a:a}function c(a){e.lastIndex=0;return e.test(a)?'"'+a.replace(e,function(a){var c=h[a];return"string"===typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function a(e,b){var d,h,m,n,p=f,l,j=b[e];j&&("object"===typeof j&&"function"===typeof j.toJSON)&&(j=j.toJSON(e));"function"===typeof k&&(j=k.call(b,e,j));switch(typeof j){case "string":return c(j);case "number":return isFinite(j)?String(j):"null";case "boolean":case "null":return String(j);case "object":if(!j)return"null";
f+=g;l=[];if("[object Array]"===Object.prototype.toString.apply(j)){n=j.length;for(d=0;d<n;d+=1)l[d]=a(d,j)||"null";m=0===l.length?"[]":f?"[\n"+f+l.join(",\n"+f)+"\n"+p+"]":"["+l.join(",")+"]";f=p;return m}if(k&&"object"===typeof k){n=k.length;for(d=0;d<n;d+=1)"string"===typeof k[d]&&(h=k[d],(m=a(h,j))&&l.push(c(h)+(f?": ":":")+m))}else for(h in j)Object.prototype.hasOwnProperty.call(j,h)&&(m=a(h,j))&&l.push(c(h)+(f?": ":":")+m);m=0===l.length?"{}":f?"{\n"+f+l.join(",\n"+f)+"\n"+p+"}":"{"+l.join(",")+
"}";f=p;return m}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+b(this.getUTCMonth()+1)+"-"+b(this.getUTCDate())+"T"+b(this.getUTCHours())+":"+b(this.getUTCMinutes())+":"+b(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var d=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
e=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,f,g,h={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},k;"function"!==typeof JSON.stringify&&(JSON.stringify=function(c,e,b){var d;g=f="";if("number"===typeof b)for(d=0;d<b;d+=1)g+=" ";else"string"===typeof b&&(g=b);if((k=e)&&"function"!==typeof e&&("object"!==typeof e||"number"!==typeof e.length))throw Error("JSON.stringify");return a("",{"":c})});
"function"!==typeof JSON.parse&&(JSON.parse=function(a,c){function e(a,b){var d,f,g=a[b];if(g&&"object"===typeof g)for(d in g)Object.prototype.hasOwnProperty.call(g,d)&&(f=e(g,d),void 0!==f?g[d]=f:delete g[d]);return c.call(a,b,g)}var b;a=String(a);d.lastIndex=0;d.test(a)&&(a=a.replace(d,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return b=eval("("+a+")"),"function"===typeof c?e({"":b},""):b;throw new SyntaxError("JSON.parse");})})();wsTrustClient=function(b){this.requestToken=function(c){c='<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing" xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"><s:Header><a:Action s:mustUnderstand="1">http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue</a:Action><a:To s:mustUnderstand="1">[To]</a:To><o:Security s:mustUnderstand="1" xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><o:UsernameToken u:Id="uuid-6a13a244-dac6-42c1-84c5-cbb345b0c4c4-1"><o:Username>[Username]</o:Username><o:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">[Password]</o:Password></o:UsernameToken></o:Security></s:Header><s:Body><trust:RequestSecurityToken xmlns:trust="http://docs.oasis-open.org/ws-sx/ws-trust/200512"><wsp:AppliesTo xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"><a:EndpointReference><a:Address>[ApplyTo]</a:Address></a:EndpointReference></wsp:AppliesTo><trust:KeyType>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Bearer</trust:KeyType><trust:RequestType>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Issue</trust:RequestType><trust:TokenType>urn:oasis:names:tc:SAML:2.0:assertion</trust:TokenType></trust:RequestSecurityToken></s:Body></s:Envelope>'.replace("[To]",
b).replace("[Username]",c.username).replace("[Password]",c.password).replace("[ApplyTo]",c.scope);return $.ajax({dataType:"XML",crossDomain:!0,url:b,type:"POST",data:c,headers:{"Content-Type":"application/soap+xml; charset=utf-8","Content-Length":c.length}})}};jQuery.support.cors="withCredentials"in new XMLHttpRequest;
var Kido=function(b,c){if(!(this instanceof Kido))return new Kido(b);b||(b="local");this.applicationName=b;this.baseUrl=c||"";this.user=null;this.send=function(a){a.url=this.baseUrl+a.url;if("GET"===a.type.toUpperCase())this.isCrossDomain(a.url)&&(a.dataType="jsonp");else if(this.isCrossDomain(a.url))return a=$.Deferred(),a.reject({msg:"Cross Domain Posting is not available.",error:"No JSONP Posting"}),a;a=$.extend({},{url:"",type:"POST",cache:a.cache||!0},a);!a.contentType&&a.data&&(a.contentType=
"application/json");if(a.url&&""!==a.url)return $.ajax(a);a=$.Deferred();a.reject({msg:"Not a valid ajax URL.",error:"invalid url"});return a};this.loginWsTrust=function(a,c,e,b){loginUrl=a;loginUser=c;loginPassword=e;loginScope=b;c='<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing" xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd"><s:Header><a:Action s:mustUnderstand="1">http://docs.oasis-open.org/ws-sx/ws-trust/200512/RST/Issue</a:Action><a:To s:mustUnderstand="1">[To]</a:To><o:Security s:mustUnderstand="1" xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><o:UsernameToken u:Id="uuid-6a13a244-dac6-42c1-84c5-cbb345b0c4c4-1"><o:Username>[Username]</o:Username><o:Password Type="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-username-token-profile-1.0#PasswordText">[Password]</o:Password></o:UsernameToken></o:Security></s:Header><s:Body><trust:RequestSecurityToken xmlns:trust="http://docs.oasis-open.org/ws-sx/ws-trust/200512"><wsp:AppliesTo xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy"><a:EndpointReference><a:Address>[ApplyTo]</a:Address></a:EndpointReference></wsp:AppliesTo><trust:KeyType>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Bearer</trust:KeyType><trust:RequestType>http://docs.oasis-open.org/ws-sx/ws-trust/200512/Issue</trust:RequestType><trust:TokenType>urn:oasis:names:tc:SAML:2.0:assertion</trust:TokenType></trust:RequestSecurityToken></s:Body></s:Envelope>'.replace("[To]",
a).replace("[Username]",usr).replace("[Password]",e).replace("[ApplyTo]",b);$.ajax({url:a,method:"POST",data:c,headers:{"Content-Type":"application/soap+xml; charset=utf-8","Content-Length":c.length},success:function(a){var c=a.indexOf("<Assertion "),b=a.indexOf("</Assertion>")+12;a=a.substring(c,b);setKidoToken(a)}})};this.isCrossDomain=function(a){if(jQuery.support.cors)return!1;var c=window.location.host;a=jQuery.url.setUrl(a).attr("host");return!a||""===a?!1:c!=a?!0:!1};this.logout=function(){loginScope=
loginPassword=loginUser=loginUrl=kidoTokenExpiration=kidoToken=null};this.renewToken=function(){login(loginUrl,loginUser,loginPassword,loginScope)}};Kido.prototype.config=function(){var b=this;return{kido:b,set:function(c,a){if(!c)throw"'name' argument is requiered.";return b.send({url:"/config/"+c,type:"POST",data:a?JSON.stringify(a):null})},get:function(c,a){if(!c)throw"'name' argument is requiered.";var d={url:"/config/"+c,type:"GET"};a&&(d.data=JSON.stringify(a));return b.send(d)},getAll:function(){return b.send({url:"/config",type:"GET"})},del:function(c){if(!c)throw"'name' argument is requiered.";return b.send({url:"/config/"+c,type:"DELETE"})}}};Kido.prototype.email=function(){var b=this;return{kido:b,send:function(c,a,d,e,f){if(!a)throw"'to' argument is required.";if(!c)throw"'from' argument is required.";c={to:a,from:c};"string"===typeof d&&0<d.length&&(c.subject=d);"string"===typeof e&&0<e.length&&(c.bodyText=e);"string"===typeof f&&0<f.length&&(c.bodyHtml=f);return b.send({url:"/email",type:"POST",data:JSON.stringify(c)})}}};Kido.prototype.logging=function(){var b=this;return{kido:b,writeVerbose:function(c){return this.write(c,0)},writeInfo:function(c){return this.write(c,1)},writeWarning:function(c){return this.write(c,2)},writeError:function(c){return this.write(c,3)},writeCritical:function(c){return this.write(c,4)},write:function(c,a){if(!c)throw"'data' argument is requiered.";if(!a&&0!==a)throw"'level' argument is required.";if(!(0<=a&&4>=a))throw"'level' argument must be an integer number between 0 and 4.";return b.send({url:"/logging?level="+
a,type:"POST",data:JSON.stringify(c)})},query:function(c,a){var d=[];c&&d.push("query="+JSON.stringify(c));a&&d.push("options="+JSON.stringify(a));return b.send({url:"/logging"+(0<d.length?"?"+d.join("&"):""),type:"GET"})},get:function(c,a,b,e){var f={};a&&(f.level=a);if(c)if(c instanceof Date)f.dateTime={$gt:c};else throw"'Since' argument accepts only null or Date values.";else f.dateTime={$exists:!0};c={$sort:{dateTime:-1}};b&&(c.$skip=b);e&&(c.$limit=e);return this.query(f,c)},clear:function(){return b.send({url:"/logging",
type:"DELETE",dataType:"text"})}}};Kido.prototype.notifications=function(){var b=this;return{send:function(c,a,d,e,f,g,h){if(!c)throw"'channel' argument is required.";if(!a)throw"'title' argument is required.";a={title:a};"string"===typeof e&&e&&(a.type=e);"string"===typeof d&&d&&(a.text=d);"string"===typeof g&&g&&(a.image=g);"number"===typeof f&&(a.badge=f);h&&(a.param=h);return b.send({url:"/notifications/push/"+b.applicationName+"/"+c,type:"POST",data:JSON.stringify(a)})}}};Kido.prototype.pubsub=function(b){var c=this;b=b||"local";return{channel:function(a){return{publish:function(d){return c.send({url:"/pubsub/"+b+"/"+a,type:"POST",data:JSON.stringify(d),dataType:"text"})},subscribe:function(c){var e=io.connect("/pubsub");e.on("connect",function(){e.emit("bindToChannel",{application:b,channel:a})});e.on("bindAccepted",function(a){e.on(a.responseChannelName,c)});return function(){e.disconnect()}}}}}};Kido.prototype.queues=function(b){var c=this;b=b||"local";return{queue:function(a){return{push:function(d){return c.send({url:"/queue/"+b+"/"+a,type:"POST",data:JSON.stringify(d),dataType:"text"})},dequeue:function(){return c.send({url:"/queue/"+b+"/"+a+"/next",type:"DELETE"})}}}}};Kido.prototype.security=function(){var b=this;return{kido:b,getLoggedInUser:function(){return b.send({url:"/user",type:"GET",dataType:"json"})},getOriginalToken:function(){return b.send({url:"/user/original-token",type:"GET",dataType:"json"})}}};Kido.prototype.sms=function(){var b=this;return{kido:b,send:function(c,a){return b.send({url:"/sms?to="+encodeURIComponent(c)+"&message="+encodeURIComponent(a),type:"POST",headers:{"Content-Length":0}})},getStatus:function(c){return b.send({url:"/sms/"+c,type:"GET"})}}};Kido.prototype.storage=function(b){var c=b||"local",a=this;return{name:c,kido:a,getObjectSetNames:function(){return a.send({url:"/storage/"+("local"===c?a.applicationName:c),type:"GET"})},objectSet:function(a){return new ObjectSet(a,this)}}};
ObjectSet=function(b,c){var a=b||"default",d=this;this.storage=c;this.name=a;d.invoke=function(b){if(!b)throw"data argument is required";if(!b.settings)throw"data.settings property is required";var d=[];b.query&&d.push("query="+JSON.stringify(b.query));b.options&&d.push("options="+JSON.stringify(b.options));b.fields&&d.push("fields="+JSON.stringify(b.fields));(!0===b.isPrivate||!1===b.isPrivate)&&d.push("isPrivate="+b.isPrivate);b.settings.url="/storage/"+("local"==c.name?c.kido.applicationName:c.name)+
"/"+a+(b.objectId?"/"+b.objectId:"")+(b.indexes?"/"+b.indexes:"")+(d.length?"?"+d.join("&"):"");b.settings.url=encodeURI(b.settings.url);b.settings.cache=b.cache;return c.kido.send(b.settings)};d.insert=function(a,b){if(!a)throw"obj argument is requiered.";a._id=void 0;var c={settings:{type:"POST",data:JSON.stringify(a)}};b&&(c.isPrivate=b);return d.invoke(c).pipe(function(b){return $.extend({},a,b)})};d.update=function(a,b){if(!a)throw"obj argument is requiered.";var c={settings:{type:"PUT",data:JSON.stringify(a)}};
b&&(c.isPrivate=b);return d.invoke(c).pipe(function(b){return $.extend({},a,b)},function(a){if(409===a.status)try{a.body=JSON.parse(a.responseText)}catch(b){}return a})};d.save=function(a,b){if(!a)throw"obj argument is requiered.";return a&&a._id&&0<a._id.length?this.update(a,b):this.insert(a,b)};d.get=function(a){var b=$.Deferred();if(a)d.invoke({settings:{type:"GET"},objectId:a,cache:!1}).fail(function(a){404===a.status?b.resolve(null):b.reject(a)}).done(function(a){b.resolve(a)});else throw"objectId is required";
return b};d.query=function(a,b,c,h){return d.invoke({settings:{type:"GET"},query:a,fields:b,options:c,cache:h})};d.del=function(a){return d.invoke({settings:{type:"DELETE",dataType:"text"},objectId:a})};d.drop=function(){return d.invoke({settings:{type:"DELETE",dataType:"text"}})}};ObjectSet.prototype.indexes=function(){var b=this;return{all:function(){return b.invoke({indexes:"indexes",settings:{type:"GET"}})},get:function(c){if(!c)throw"'name' argument is requiered.";return b.invoke({indexes:"indexes?name="+c,settings:{type:"GET"}})},del:function(c){if(!c)throw"'name' argument is requiered.";return b.invoke({indexes:"indexes/"+c,settings:{type:"DELETE"}})},create:function(c,a,d,e,f,g,h,k){if(!c)throw"'spec' argument is requiered.";a||(a=!1);d||(d=!1);e||(e=!1);f||(f=!1);g||
(g=!1);c={spec:c,options:{safe:a,unique:d,sparse:e,background:f,dropDups:g}};h&&"0"!=h.toString()&&(c.options.min=h);k&&"0"!=k.toString()&&(c.options.max=k);h={indexes:"indexes",settings:{type:"POST",data:JSON.stringify(c)}};return b.invoke(h)}}};Kido.prototype.updater=function(b){this.pubsub().channel("auto-updater",function(c){b(c)&&location.reload(!0)})};
